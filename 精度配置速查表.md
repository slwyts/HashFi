# 🎯 精度配置快速参考卡

## 📏 记住这个规则

```typescript
// 您的项目配置
USDT_DECIMALS = 18  // ⚠️ 不是标准的 6！
HAF_DECIMALS = 18
HAF_PRICE_PRECISION = 18
BTC_PRICE_DECIMALS = 6
```

---

## 🔧 formatUnits 使用速查表

| 数据来源 | 第二个参数 | 示例 |
|---------|-----------|------|
| `record.usdtAmount` | **18** | `formatUnits(usdtAmount, 18)` |
| `record.hafAmount` | **18** | `formatUnits(hafAmount, 18)` |
| `hafPrice` (来自合约) | **18** | `formatUnits(hafPrice, 18)` |
| `btcPrice` (来自合约) | **6** | `formatUnits(btcPrice, 6)` |
| `usdtBalance` | **18** | `formatUnits(balance, 18)` |
| `hafBalance` | **18** | `formatUnits(balance, 18)` |

---

## ✅ 正确示例

```typescript
// USDT 相关
const usdtDisplay = formatUnits(usdtAmount, 18);  // ✅

// HAF 价格
const price = formatUnits(hafPrice, 18);  // ✅
// hafPrice = 1e18 → "1.0"

// HAF 金额
const haf = formatUnits(hafAmount, 18);  // ✅

// BTC 价格
const btc = formatUnits(btcPrice, 6);  // ✅
// btcPrice = 50000500000 → "50000.5"
```

---

## ❌ 常见错误

```typescript
// ❌ 错误：USDT 用了 6 位
formatUnits(usdtAmount, 6)
// 810000000000000000000000 ÷ 10^6 = 810000000000000000 💥

// ❌ 错误：hafPrice 用了 6 位
formatUnits(hafPrice, 6)
// 1000000000000000000 ÷ 10^6 = 1000000000000 💥

// ❌ 错误：BTC 用了 18 位
formatUnits(btcPrice, 18)
// 50000500000 ÷ 10^18 = 0.000050000500000 💥
```

---

## 🧮 计算示例

### 计算 HAF 价值（USDT）
```typescript
// ✅ 正确
const hafAmount = parseFloat(formatUnits(hafBalance, 18));
const hafPrice = parseFloat(formatUnits(hafPriceData, 18));
const totalValue = hafAmount * hafPrice;

// 例如:
// hafBalance = 5349575810000000000000000n
// hafAmount = 5349575.81
// hafPrice = 1.0
// totalValue = 5349575.81 USDT ✅
```

### 计算 HAF 兑换数量
```typescript
// ✅ 正确：USDT → HAF
const usdtAmount = 1000; // 1000 USDT
const hafPrice = parseFloat(formatUnits(hafPriceData, 18));
const hafAmount = usdtAmount / hafPrice;

// 例如:
// usdtAmount = 1000
// hafPrice = 1.0
// hafAmount = 1000 HAF ✅
```

---

## 🎨 显示格式化建议

```typescript
// USDT 金额 - 2 位小数
parseFloat(formatUnits(amount, 18)).toFixed(2)
// 例: "810000.00"

// HAF 金额 - 4 位小数
parseFloat(formatUnits(amount, 18)).toFixed(4)
// 例: "808382.4267"

// HAF 价格 - 4 位小数
parseFloat(formatUnits(hafPrice, 18)).toFixed(4)
// 例: "1.0000"

// BTC 价格 - 2 位小数
parseFloat(formatUnits(btcPrice, 6)).toFixed(2)
// 例: "50000.50"
```

---

## 🚨 调试技巧

```typescript
// 检查原始值
console.log('Raw value:', amount.toString());
console.log('With 6 decimals:', formatUnits(amount, 6));
console.log('With 18 decimals:', formatUnits(amount, 18));

// 如果看到天文数字，说明精度错了！
// 正确的 USDT/HAF 金额应该在 0.0001 ~ 几百万 之间
```

---

## 📌 记住

> **除了 BTC 相关数据，其他所有金额和价格都是 18 位！**

粘贴到你的编辑器：
```typescript
// HashFi 项目精度配置
const DECIMALS = {
  USDT: 18,    // ⚠️ 特殊！不是 6
  HAF: 18,
  PRICE: 18,   // hafPrice 精度
  BTC: 6,      // 只有 BTC 相关
};
```
