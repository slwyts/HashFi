# 提现失败问题 - 快速修复说明

## 🔴 问题
用户质押后第二天提现失败，错误: `No rewards to withdraw`

## 🔍 原因
收益在结算时被**提前分发了两次**:
1. `_settleUserRewards()` 时分发了一次 ❌
2. `withdraw()` 时又想分发一次 ❌
3. 导致第二次检测不到可提现金额

## ✅ 修复
移除结算函数中的代币分发逻辑，只保留在 `withdraw()` 中统一分发:

### 修改的函数
1. **`_settleStaticRewardForOrder()`** - 删除 `_distributeHaf()` 调用
2. **`_settleGenesisRewardForNode()`** - 删除 `_distributeHaf()` 调用

### 修复后流程
```
质押后 → 每天结算(只更新状态) → 用户调用withdraw() → 统一分发HAF ✅
```

## 📝 需要做的事
1. ✅ 已修复代码
2. ⏳ 重新编译合约
3. ⏳ 部署到测试网测试
4. ⏳ 测试提现功能
5. ⏳ 部署到主网

## 🧪 测试要点
- [ ] 质押233 USDT (青铜)
- [ ] 等待1天
- [ ] 查看待提现金额 (约0.88 HAF)
- [ ] 点击提现
- [ ] 验证交易成功
- [ ] 验证HAF余额增加
