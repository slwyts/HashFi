# æ¨èäººç»‘å®šé€»è¾‘ä¼˜åŒ– - Owner ç‰¹æ®Šå¤„ç†

## ğŸ¯ é—®é¢˜èƒŒæ™¯

### å†·å¯åŠ¨é—®é¢˜
åœ¨åˆçº¦åˆšéƒ¨ç½²æ—¶ï¼Œæ²¡æœ‰ä»»ä½•ç”¨æˆ·è´¨æŠ¼è¿‡ï¼Œå¯¼è‡´ï¼š
- âŒ æ— æ³•ç»‘å®šæ¨èäººï¼ˆå› ä¸ºæ²¡æœ‰ç¬¦åˆæ¡ä»¶çš„æ¨èäººï¼‰
- âŒ æ— æ³•è¿›è¡Œç¬¬ä¸€ç¬”è´¨æŠ¼ï¼ˆå› ä¸ºå¿…é¡»å…ˆç»‘å®šæ¨èäººï¼‰
- âŒ é™·å…¥æ­»é”çŠ¶æ€

### åŸå§‹é€»è¾‘
```solidity
function bindReferrer(address _referrer) external {
    require(users[_referrer].totalStakedAmount > 0, "Referrer does not exist");
    // âŒ è¦æ±‚æ¨èäººå¿…é¡»å·²ç»è´¨æŠ¼è¿‡
}
```

**é—®é¢˜ï¼š**
```
ç¬¬ä¸€ä¸ªç”¨æˆ· â†’ æƒ³è¦è´¨æŠ¼
           â†“
       éœ€è¦ç»‘å®šæ¨èäºº
           â†“
       æ²¡æœ‰ä»»ä½•äººè´¨æŠ¼è¿‡
           â†“
       âŒ æ— æ³•ç»‘å®šæ¨èäºº
           â†“
       âŒ æ— æ³•è´¨æŠ¼
           â†“
       ğŸ”’ æ­»é”ï¼
```

---

## âœ… è§£å†³æ–¹æ¡ˆ

### Owner ä½œä¸ºå†·å¯åŠ¨æ¨èäºº

**æ ¸å¿ƒæ€æƒ³ï¼š** å…è®¸åˆçº¦ owner ä½œä¸ºæ¨èäººï¼Œå³ä½¿ä»–æ²¡æœ‰æŠ•èµ„è¿‡

### ä¿®æ”¹åçš„ä»£ç 

```solidity
function bindReferrer(address _referrer) external whenNotPaused {
    User storage user = users[msg.sender];
    require(user.referrer == address(0), "Referrer already bound");
    
    // âœ… æ–°é€»è¾‘ï¼šå…è®¸ç»‘å®š owner æˆ–å·²æŠ•èµ„ç”¨æˆ·
    require(
        _referrer == owner() || users[_referrer].totalStakedAmount > 0, 
        "Referrer does not exist"
    );
    
    require(_referrer != msg.sender, "Cannot refer yourself");
    user.referrer = _referrer;
    users[_referrer].directReferrals.push(msg.sender);
    emit ReferrerBound(msg.sender, _referrer);
}
```

### é€»è¾‘è¯´æ˜

```
æ¨èäººéªŒè¯ï¼š
â”œâ”€ æ˜¯ ownerï¼Ÿ
â”‚  â””â”€ âœ… å…è®¸ï¼ˆå³ä½¿æ²¡æŠ•èµ„ï¼‰
â”‚
â””â”€ ä¸æ˜¯ ownerï¼Ÿ
   â””â”€ æ£€æŸ¥ totalStakedAmount > 0
      â”œâ”€ âœ… å·²æŠ•èµ„ â†’ å…è®¸
      â””â”€ âŒ æœªæŠ•èµ„ â†’ æ‹’ç»
```

---

## ğŸ”„ å†·å¯åŠ¨æµç¨‹

### é˜¶æ®µ 1: åˆçº¦éƒ¨ç½²
```
éƒ¨ç½²åˆçº¦
â”œâ”€ Owner: 0xOwner
â”œâ”€ æ€»ç”¨æˆ·: 0
â””â”€ å·²è´¨æŠ¼: 0 USDT
```

### é˜¶æ®µ 2: ç¬¬ä¸€æ‰¹ç”¨æˆ·
```
ç”¨æˆ· A æ³¨å†Œ
â”œâ”€ ç»‘å®šæ¨èäºº: 0xOwner âœ… (å…è®¸ï¼)
â”œâ”€ è´¨æŠ¼: 1000 USDT
â””â”€ Owner è·å¾—æ¨èå¥–åŠ± ğŸ’°

ç”¨æˆ· B æ³¨å†Œ
â”œâ”€ ç»‘å®šæ¨èäºº: 0xOwner âœ… (å…è®¸ï¼)
â”œâ”€ è´¨æŠ¼: 5000 USDT
â””â”€ Owner è·å¾—æ¨èå¥–åŠ± ğŸ’°

ç”¨æˆ· C æ³¨å†Œ
â”œâ”€ ç»‘å®šæ¨èäºº: 0xOwner âœ… (å…è®¸ï¼)
â”œâ”€ è´¨æŠ¼: 10000 USDT
â””â”€ Owner è·å¾—æ¨èå¥–åŠ± ğŸ’°
```

### é˜¶æ®µ 3: ç½‘ç»œæ‰©å±•
```
ç”¨æˆ· D æ³¨å†Œ
â”œâ”€ ç»‘å®šæ¨èäºº: ç”¨æˆ· A âœ… (å·²æŠ•èµ„)
â”œâ”€ è´¨æŠ¼: 2000 USDT
â””â”€ ç”¨æˆ· A è·å¾—æ¨èå¥–åŠ± ğŸ’°

ç”¨æˆ· E æ³¨å†Œ
â”œâ”€ ç»‘å®šæ¨èäºº: ç”¨æˆ· B âœ… (å·²æŠ•èµ„)
â”œâ”€ è´¨æŠ¼: 3000 USDT
â””â”€ ç”¨æˆ· B è·å¾—æ¨èå¥–åŠ± ğŸ’°

... ç½‘ç»œæŒç»­å¢é•¿
```

---

## ğŸ¨ å‰ç«¯å®ç°

### 1. è·å– Owner åœ°å€

```typescript
// Profile.vue æˆ– Staking.vue
import { useReadContract } from '@wagmi/vue';

const { data: ownerAddress } = useReadContract({
  address: CONTRACT_ADDRESS,
  abi,
  functionName: 'owner',
});
```

### 2. é»˜è®¤æ¨èäºº

```typescript
// åœ¨ç»‘å®šæ¨èäººæ—¶æä¾›é»˜è®¤é€‰é¡¹
const referrerAddress = ref('');

// å¦‚æœç”¨æˆ·æ²¡æœ‰æ¨èäººï¼Œé»˜è®¤æ˜¾ç¤º owner
onMounted(() => {
  if (ownerAddress.value) {
    referrerAddress.value = ownerAddress.value;
  }
});
```

### 3. ç»‘å®šæ¨èäººæ¨¡æ€æ¡†

```vue
<template>
  <div class="bind-referrer-modal">
    <h3>ç»‘å®šæ¨èäºº</h3>
    
    <!-- é»˜è®¤æ¨èäººæç¤º -->
    <div v-if="!hasCustomReferrer" class="default-referrer">
      <p>ğŸ’¡ æç¤ºï¼šæ²¡æœ‰æ¨èäººï¼Ÿ</p>
      <p>å¯ä»¥ä½¿ç”¨å¹³å°é»˜è®¤æ¨èäºº</p>
      <button @click="useDefaultReferrer">
        ä½¿ç”¨é»˜è®¤æ¨èäºº
      </button>
    </div>
    
    <!-- æˆ–è¾“å…¥è‡ªå®šä¹‰æ¨èäºº -->
    <div>
      <input 
        v-model="referrerAddress" 
        placeholder="æˆ–è¾“å…¥æ¨èäººåœ°å€ 0x..."
      />
      <button @click="bindReferrer">
        ç¡®è®¤ç»‘å®š
      </button>
    </div>
  </div>
</template>

<script setup lang="ts">
const useDefaultReferrer = () => {
  referrerAddress.value = ownerAddress.value;
  toast.info('å·²é€‰æ‹©å¹³å°é»˜è®¤æ¨èäºº');
};
</script>
```

---

## ğŸ“Š å¯¹æ¯”åˆ†æ

### ä¿®æ”¹å‰ âŒ

```
åˆçº¦éƒ¨ç½²
  â†“
ç¬¬ä¸€ä¸ªç”¨æˆ·æƒ³è¦è´¨æŠ¼
  â†“
ç»‘å®šæ¨èäººï¼Ÿ
  â”œâ”€ Owner: âŒ æœªæŠ•èµ„ï¼Œä¸èƒ½ç»‘å®š
  â”œâ”€ å…¶ä»–ç”¨æˆ·: âŒ éƒ½æ²¡æŠ•èµ„
  â””â”€ æ— äººå¯ç»‘å®š ğŸ”’ æ­»é”
```

### ä¿®æ”¹å âœ…

```
åˆçº¦éƒ¨ç½²
  â†“
ç¬¬ä¸€ä¸ªç”¨æˆ·æƒ³è¦è´¨æŠ¼
  â†“
ç»‘å®šæ¨èäººï¼Ÿ
  â”œâ”€ Owner: âœ… å¯ä»¥ç»‘å®šï¼ˆç‰¹æ®Šå¤„ç†ï¼‰
  â””â”€ å®Œæˆè´¨æŠ¼ ğŸ‰
     â†“
æ›´å¤šç”¨æˆ·åŠ å…¥
  â”œâ”€ ç»‘å®š Owner âœ…
  â”œâ”€ ç»‘å®šå·²æŠ•èµ„ç”¨æˆ· âœ…
  â””â”€ ç½‘ç»œå¢é•¿ ğŸ“ˆ
```

---

## ğŸ” å®‰å…¨æ€§åˆ†æ

### æ½œåœ¨é£é™©
1. **Owner å„æ–­æ¨èæ”¶ç›Š** - åˆæœŸæ‰€æœ‰ç”¨æˆ·éƒ½ç»‘å®š owner
2. **ä¸­å¿ƒåŒ–é—®é¢˜** - Owner æ§åˆ¶åˆå§‹æ¨èå…³ç³»

### é£é™©ç¼“è§£
1. **é¼“åŠ±ç”¨æˆ·æ¨å¹¿** - é€šè¿‡å¥–åŠ±æœºåˆ¶æ¿€åŠ±ç”¨æˆ·é‚€è¯·ä»–äºº
2. **Owner è‡ªæ„¿è®©åˆ©** - Owner å¯ä»¥å°†åˆæœŸæ”¶ç›Šç”¨äºå¹³å°å‘å±•
3. **è‡ªç„¶å»ä¸­å¿ƒåŒ–** - éšç€ç”¨æˆ·å¢é•¿ï¼Œæ¨èå…³ç³»è‡ªç„¶åˆ†æ•£

### ä¼˜åŠ¿
1. **è§£å†³å†·å¯åŠ¨** - å¹³å°å¯ä»¥æ­£å¸¸å¯åŠ¨
2. **Owner æ‰¿æ‹…é£é™©** - Owner æŠ•å…¥ç²¾åŠ›æ¨å¹¿ï¼Œè·å¾—æ”¶ç›Šåˆç†
3. **è¿‡æ¸¡æ–¹æ¡ˆ** - åˆæœŸä¾èµ– ownerï¼ŒåæœŸè‡ªç„¶å»ä¸­å¿ƒåŒ–

---

## ğŸ“ ä½¿ç”¨åœºæ™¯

### åœºæ™¯ 1: æ–°å¹³å°å¯åŠ¨
```
ç®¡ç†å‘˜éƒ¨ç½²åˆçº¦
  â†“
ç¤¾åŒºæ¨å¹¿
  â†“
ç¬¬ä¸€æ‰¹ç”¨æˆ·æ³¨å†Œ
  â”œâ”€ ç”¨æˆ· A: ç»‘å®š Owner
  â”œâ”€ ç”¨æˆ· B: ç»‘å®š Owner
  â””â”€ ç”¨æˆ· C: ç»‘å®š Owner
     â†“
å¹³å°å¼€å§‹è¿è½¬ âœ…
```

### åœºæ™¯ 2: ç”¨æˆ·è‡ªä¸»æ¨å¹¿
```
ç”¨æˆ· Aï¼ˆå·²æŠ•èµ„ï¼‰
  â†“
é‚€è¯·æœ‹å‹ B
  â†“
æœ‹å‹ B æ³¨å†Œ
  â”œâ”€ ç»‘å®šç”¨æˆ· Aï¼ˆé ownerï¼‰
  â””â”€ ç”¨æˆ· A è·å¾—æ¨èå¥–åŠ±
     â†“
å½¢æˆæ¨èç½‘ç»œ ğŸ•¸ï¸
```

### åœºæ™¯ 3: æ··åˆæ¨¡å¼
```
æ–°ç”¨æˆ·æ³¨å†Œ
  â†“
é€‰æ‹©æ¨èäºº
  â”œâ”€ æœ‰é‚€è¯·äºº â†’ ç»‘å®šé‚€è¯·äºº
  â”œâ”€ æ²¡æœ‰é‚€è¯·äºº â†’ ç»‘å®š Owner
  â””â”€ çµæ´»é€‰æ‹© ğŸ’¡
```

---

## ğŸ¯ å‰ç«¯ä¼˜åŒ–å»ºè®®

### 1. æ™ºèƒ½æ¨èäººé€‰æ‹©

```typescript
// æ¨èäººé€‰æ‹©é€»è¾‘
const suggestReferrer = () => {
  // 1. æ£€æŸ¥ URL å‚æ•°
  const refFromUrl = route.query.ref;
  if (refFromUrl) {
    return refFromUrl;  // ä¼˜å…ˆä½¿ç”¨é‚€è¯·é“¾æ¥
  }
  
  // 2. æ£€æŸ¥æœ¬åœ°å­˜å‚¨
  const savedRef = localStorage.getItem('referrer');
  if (savedRef) {
    return savedRef;
  }
  
  // 3. é»˜è®¤ä½¿ç”¨ Owner
  return ownerAddress.value;
};
```

### 2. ç”¨æˆ·å‹å¥½æç¤º

```vue
<div class="referrer-selector">
  <!-- åœºæ™¯ 1: æœ‰é‚€è¯·é“¾æ¥ -->
  <div v-if="hasInviteLink">
    <p>âœ… æ‚¨é€šè¿‡é‚€è¯·é“¾æ¥æ³¨å†Œ</p>
    <p>æ¨èäººï¼š{{ referrerAddress }}</p>
  </div>
  
  <!-- åœºæ™¯ 2: æ²¡æœ‰é‚€è¯·äºº -->
  <div v-else>
    <p>ğŸ’¡ æ‚¨è¿˜æ²¡æœ‰æ¨èäºº</p>
    <p>å¯ä»¥ä½¿ç”¨å¹³å°é»˜è®¤æ¨èäººï¼Œæˆ–è¾“å…¥æ‚¨çš„é‚€è¯·äººåœ°å€</p>
    <button @click="useOwner">ä½¿ç”¨é»˜è®¤</button>
    <button @click="inputCustom">è¾“å…¥åœ°å€</button>
  </div>
</div>
```

### 3. Owner æ˜¾ç¤ºä¼˜åŒ–

```typescript
// æ˜¾ç¤ºæ¨èäººæ—¶ç‰¹æ®Šå¤„ç† owner
const referrerDisplayName = computed(() => {
  if (referrer === ownerAddress.value) {
    return 'å¹³å°å®˜æ–¹';  // æˆ– "Platform Official"
  }
  return `${referrer.substring(0, 6)}...${referrer.substring(38)}`;
});
```

---

## ğŸ§ª æµ‹è¯•åœºæ™¯

### æµ‹è¯• 1: Owner ä½œä¸ºæ¨èäºº
```javascript
// 1. éƒ¨ç½²åˆçº¦
// 2. ç”¨æˆ· A ç»‘å®š ownerï¼ˆowner æœªæŠ•èµ„ï¼‰
await bindReferrer(ownerAddress);
// âœ… åº”è¯¥æˆåŠŸ

// 3. ç”¨æˆ· A è´¨æŠ¼
await stake(1000);
// âœ… åº”è¯¥æˆåŠŸ
```

### æµ‹è¯• 2: æ™®é€šç”¨æˆ·ä½œä¸ºæ¨èäºº
```javascript
// 1. ç”¨æˆ· B å°è¯•ç»‘å®šç”¨æˆ· Cï¼ˆC æœªæŠ•èµ„ï¼‰
await bindReferrer(userC);
// âŒ åº”è¯¥å¤±è´¥ "Referrer does not exist"

// 2. ç”¨æˆ· C å…ˆæŠ•èµ„
await stake(1000);

// 3. ç”¨æˆ· B å†ç»‘å®šç”¨æˆ· C
await bindReferrer(userC);
// âœ… åº”è¯¥æˆåŠŸ
```

### æµ‹è¯• 3: è¾¹ç•Œæƒ…å†µ
```javascript
// 1. Owner ç»‘å®šè‡ªå·±
await bindReferrer(ownerAddress);  // msg.sender == owner
// âŒ åº”è¯¥å¤±è´¥ "Cannot refer yourself"

// 2. é‡å¤ç»‘å®š
await bindReferrer(ownerAddress);  // ç¬¬ä¸€æ¬¡ âœ…
await bindReferrer(userA);         // ç¬¬äºŒæ¬¡ âŒ
// âŒ åº”è¯¥å¤±è´¥ "Referrer already bound"
```

---

## ğŸ“‹ éƒ¨ç½²æ£€æŸ¥æ¸…å•

### åˆçº¦éƒ¨ç½²å
- [ ] éªŒè¯ owner åœ°å€
- [ ] è®°å½• owner åœ°å€åˆ°å‰ç«¯é…ç½®
- [ ] æµ‹è¯• owner ä½œä¸ºæ¨èäººçš„ç»‘å®š

### å‰ç«¯æ›´æ–°
- [ ] æ·»åŠ "ä½¿ç”¨é»˜è®¤æ¨èäºº"åŠŸèƒ½
- [ ] æ˜¾ç¤º owner ä¸º"å¹³å°å®˜æ–¹"
- [ ] æµ‹è¯•å®Œæ•´æµç¨‹

### ç”¨æˆ·æŒ‡å—
- [ ] è¯´æ˜æ¨èäººæœºåˆ¶
- [ ] æä¾›é»˜è®¤æ¨èäººé€‰é¡¹
- [ ] è§£é‡Š owner çš„ç‰¹æ®Šåœ°ä½

---

## ğŸ‰ æ€»ç»“

### ä¼˜åŒ–å‰
```
âŒ å†·å¯åŠ¨é—®é¢˜ â†’ ç¬¬ä¸€ä¸ªç”¨æˆ·æ— æ³•è´¨æŠ¼
âŒ æ­»é”çŠ¶æ€ â†’ æ— äººå¯ä½œä¸ºæ¨èäºº
âŒ å¹³å°æ— æ³•å¯åŠ¨
```

### ä¼˜åŒ–å
```
âœ… Owner å¯ä½œä¸ºæ¨èäººï¼ˆå³ä½¿æœªæŠ•èµ„ï¼‰
âœ… ç¬¬ä¸€æ‰¹ç”¨æˆ·å¯ä»¥æ­£å¸¸è´¨æŠ¼
âœ… å¹³å°é¡ºåˆ©å¯åŠ¨
âœ… è‡ªç„¶è¿‡æ¸¡åˆ°å»ä¸­å¿ƒåŒ–æ¨èç½‘ç»œ
```

### ä»£ç æ”¹åŠ¨
```solidity
// ä¸€è¡Œä»£ç è§£å†³å†·å¯åŠ¨é—®é¢˜ï¼
require(
  _referrer == owner() || users[_referrer].totalStakedAmount > 0,
  "Referrer does not exist"
);
```

### å½±å“
- âœ… è§£å†³åˆçº¦å†·å¯åŠ¨
- âœ… æå‡ç”¨æˆ·ä½“éªŒ
- âœ… ä¿æŒå®‰å…¨æ€§
- âœ… ä¿ƒè¿›å¹³å°å‘å±•

---

**ä¿®æ”¹å®Œæˆæ—¥æœŸï¼š** 2025-10-07  
**ç‰ˆæœ¬ï¼š** v2.2  
**çŠ¶æ€ï¼š** âœ… å·²ä¼˜åŒ–
