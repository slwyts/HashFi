# ğŸš€ è½®æ’­å›¾å’Œå…¬å‘Šç®¡ç†ç³»ç»Ÿéƒ¨ç½²æŒ‡å—

## æ¦‚è¿°

æˆ‘ä»¬å·²ç»åœ¨ Admin.vue ä¸­é›†æˆäº†è½®æ’­å›¾å’Œå…¬å‘Šç®¡ç†åŠŸèƒ½,ä½¿ç”¨ Cloudflare Workers ä½œä¸ºå…è´¹åç«¯ã€‚

## âœ… å·²å®Œæˆçš„å·¥ä½œ

### 1. å‰ç«¯ç»„ä»¶
- âœ… `/src/components/admin/BannerManagement.vue` - è½®æ’­å›¾ç®¡ç†ç•Œé¢
- âœ… `/src/components/admin/AnnouncementManagement.vue` - å…¬å‘Šç®¡ç†ç•Œé¢
- âœ… `/src/views/Admin.vue` - å·²é›†æˆä¸¤ä¸ªæ–°æ ‡ç­¾é¡µ
- âœ… ç­¾åè®¤è¯åŠŸèƒ½ (ä½¿ç”¨é’±åŒ…ç­¾å)

### 2. åç«¯ API
- âœ… `/cloudflare-worker/src/index.ts` - Cloudflare Workers API
- âœ… è½®æ’­å›¾ CRUD æ¥å£
- âœ… å…¬å‘Š CRUD æ¥å£
- âœ… ç®€å•çš„ç­¾åéªŒè¯ (è£…ä¸ªæ ·å­çš„é‚£ç§ ğŸ˜)

### 3. æ•°æ®å­˜å‚¨
- âœ… Cloudflare KV (å…è´¹ 1GB å­˜å‚¨)

## ğŸ“‹ éƒ¨ç½²æ­¥éª¤

### ç¬¬ä¸€æ­¥: éƒ¨ç½² Cloudflare Worker

```bash
# 1. è¿›å…¥ Worker ç›®å½•
cd cloudflare-worker

# 2. å®‰è£…ä¾èµ–
npm install

# 3. ç™»å½• Cloudflare (é¦–æ¬¡éƒ¨ç½²éœ€è¦)
npx wrangler login

# 4. åˆ›å»º KV å‘½åç©ºé—´
npx wrangler kv:namespace create HASHFI_DATA

# è¾“å‡ºç¤ºä¾‹:
# [[kv_namespaces]]
# binding = "HASHFI_DATA"
# id = "xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx"

# 5. æŠŠä¸Šé¢çš„ id å¤åˆ¶åˆ° wrangler.toml æ–‡ä»¶ä¸­
# ç¼–è¾‘ wrangler.toml, æ›¿æ¢è¿™ä¸€è¡Œ:
# id = "ä½ çš„KVå‘½åç©ºé—´ID"

# 6. éƒ¨ç½²!
npm run deploy
```

éƒ¨ç½²æˆåŠŸåä¼šæ˜¾ç¤º Worker URL,ç±»ä¼¼:
```
https://hashfi-api.your-subdomain.workers.dev
```

### ç¬¬äºŒæ­¥: é…ç½®å‰ç«¯

```bash
# 1. å›åˆ°é¡¹ç›®æ ¹ç›®å½•
cd ..

# 2. åˆ›å»º .env æ–‡ä»¶
cp .env.example .env

# 3. ç¼–è¾‘ .env æ–‡ä»¶,å¡«å…¥ Worker URL
VITE_API_URL=https://hashfi-api.your-subdomain.workers.dev
```

### ç¬¬ä¸‰æ­¥: é‡æ–°æ„å»ºå‰ç«¯

```bash
# å¼€å‘æ¨¡å¼
npm run dev

# æˆ–ç”Ÿäº§æ„å»º
npm run build
```

## ğŸ® ä½¿ç”¨è¯´æ˜

### 1. è®¿é—®ç®¡ç†å‘˜é¢æ¿

è®¿é—®ä½ çš„ç½‘ç«™,è¿›å…¥ç®¡ç†å‘˜é¢æ¿ (Admin é¡µé¢)

### 2. è¿›è¡Œç­¾åè®¤è¯

ç‚¹å‡»å³ä¸Šè§’çš„ "ç­¾åè®¤è¯" æŒ‰é’®,ç”¨é’±åŒ…ç­¾åä¸€æ¬¡ã€‚ç­¾åä¼šä¿å­˜åœ¨ localStorage,ä¸‹æ¬¡ä¸éœ€è¦é‡æ–°ç­¾åã€‚

> **æ³¨æ„**: è¿™ä¸ªç­¾åéªŒè¯æ˜¯"è£…æ ·å­"çš„å®ç°,åªæ£€æŸ¥ç­¾åé•¿åº¦ > 10 å°±é€šè¿‡ã€‚å¦‚æœéœ€è¦çœŸæ­£çš„å®‰å…¨éªŒè¯,éœ€è¦ä¿®æ”¹ Worker çš„ `isAuthorized` å‡½æ•°ã€‚

### 3. ç®¡ç†è½®æ’­å›¾

- ç‚¹å‡» "è½®æ’­å›¾" æ ‡ç­¾
- å¯ä»¥æ·»åŠ ã€ç¼–è¾‘ã€åˆ é™¤è½®æ’­å›¾
- è®¾ç½®å›¾ç‰‡ URLã€æ ‡é¢˜ã€æè¿°ã€é“¾æ¥ç­‰
- å¯ä»¥è°ƒæ•´æ˜¾ç¤ºé¡ºåº
- å¯ä»¥å¯ç”¨/ç¦ç”¨

### 4. ç®¡ç†å…¬å‘Š

- ç‚¹å‡» "å…¬å‘Š" æ ‡ç­¾
- å¯ä»¥å‘å¸ƒã€ç¼–è¾‘ã€åˆ é™¤å…¬å‘Š
- è®¾ç½®å…¬å‘Šç±»å‹ (æ™®é€š/é‡è¦/ç´§æ€¥)
- å¯ä»¥æ·»åŠ è¯¦æƒ…é“¾æ¥
- å¯ä»¥å‘å¸ƒ/éšè—

## ğŸ”§ å‰ç«¯ç»„ä»¶ä½¿ç”¨è½®æ’­å›¾å’Œå…¬å‘Š

### è·å–è½®æ’­å›¾

åœ¨ `BannerCarousel.vue` æˆ–å…¶ä»–ç»„ä»¶ä¸­:

```vue
<script setup lang="ts">
import { ref, onMounted } from 'vue';

const API_URL = import.meta.env.VITE_API_URL;
const banners = ref([]);

onMounted(async () => {
  const response = await fetch(`${API_URL}/banners`);
  const data = await response.json();
  // åªæ˜¾ç¤ºå¯ç”¨çš„è½®æ’­å›¾
  banners.value = data.banners.filter(b => b.active).sort((a, b) => a.order - b.order);
});
</script>
```

### è·å–å…¬å‘Š

åœ¨ `AnnouncementBanner.vue` æˆ–å…¶ä»–ç»„ä»¶ä¸­:

```vue
<script setup lang="ts">
import { ref, onMounted } from 'vue';

const API_URL = import.meta.env.VITE_API_URL;
const announcements = ref([]);

onMounted(async () => {
  const response = await fetch(`${API_URL}/announcements`);
  const data = await response.json();
  // åªæ˜¾ç¤ºå¯ç”¨çš„å…¬å‘Š,æŒ‰æ—¶é—´å€’åº
  announcements.value = data.announcements
    .filter(a => a.active)
    .sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt));
});
</script>
```

## ğŸ’¡ æ•°æ®ç»“æ„

### Banner (è½®æ’­å›¾)

```typescript
{
  id: string;              // è‡ªåŠ¨ç”Ÿæˆ
  title: string;           // æ ‡é¢˜
  description: string;     // æè¿°
  imageUrl: string;        // å›¾ç‰‡URL
  link?: string;           // ç‚¹å‡»è·³è½¬é“¾æ¥ (å¯é€‰)
  order: number;           // æ˜¾ç¤ºé¡ºåº (0, 1, 2...)
  active: boolean;         // æ˜¯å¦å¯ç”¨
  createdAt: string;       // åˆ›å»ºæ—¶é—´ (ISOæ ¼å¼)
}
```

### Announcement (å…¬å‘Š)

```typescript
{
  id: string;              // è‡ªåŠ¨ç”Ÿæˆ
  title: string;           // æ ‡é¢˜
  content: string;         // å†…å®¹
  type: 'normal' | 'important' | 'urgent';  // ç±»å‹
  link?: string;           // è¯¦æƒ…é“¾æ¥ (å¯é€‰)
  active: boolean;         // æ˜¯å¦å‘å¸ƒ
  createdAt: string;       // åˆ›å»ºæ—¶é—´ (ISOæ ¼å¼)
}
```

## ğŸ¯ API ç«¯ç‚¹

| æ–¹æ³• | è·¯å¾„ | è¯´æ˜ | éœ€è¦ç­¾å |
|------|------|------|---------|
| GET | `/banners` | è·å–æ‰€æœ‰è½®æ’­å›¾ | âŒ |
| POST | `/banners` | åˆ›å»ºè½®æ’­å›¾ | âœ… |
| PUT | `/banners/:id` | æ›´æ–°è½®æ’­å›¾ | âœ… |
| DELETE | `/banners/:id` | åˆ é™¤è½®æ’­å›¾ | âœ… |
| GET | `/announcements` | è·å–æ‰€æœ‰å…¬å‘Š | âŒ |
| POST | `/announcements` | åˆ›å»ºå…¬å‘Š | âœ… |
| PUT | `/announcements/:id` | æ›´æ–°å…¬å‘Š | âœ… |
| DELETE | `/announcements/:id` | åˆ é™¤å…¬å‘Š | âœ… |

## ğŸ†“ æˆæœ¬è¯´æ˜

### Cloudflare Workers å…è´¹å¥—é¤

- âœ… æ¯å¤© 100,000 æ¬¡è¯·æ±‚
- âœ… 1GB KV å­˜å‚¨
- âœ… æ¯å¤© 100,000 æ¬¡ KV è¯»å–
- âœ… æ¯å¤© 1,000 æ¬¡ KV å†™å…¥

**å¯¹äºè¿™ä¸ªé¡¹ç›®æ¥è¯´ç»°ç»°æœ‰ä½™!** ğŸ‰

## ğŸ”’ å®‰å…¨è¯´æ˜

å½“å‰å®ç°çš„ç­¾åéªŒè¯æ˜¯"è£…æ ·å­"çš„,åªæ£€æŸ¥ç­¾åé•¿åº¦ã€‚å¦‚æœéœ€è¦çœŸæ­£çš„å®‰å…¨éªŒè¯:

1. ä¿®æ”¹ `cloudflare-worker/src/index.ts` ä¸­çš„ `isAuthorized` å‡½æ•°
2. å®ç°çœŸæ­£çš„ç­¾åéªŒè¯é€»è¾‘
3. éªŒè¯ç­¾åè€…åœ°å€æ˜¯å¦ä¸ºç®¡ç†å‘˜åœ°å€

ç¤ºä¾‹:

```typescript
import { verifyMessage } from 'viem';

function isAuthorized(request: Request): boolean {
  const authHeader = request.headers.get('Authorization');
  if (!authHeader) return false;
  
  const signature = authHeader.replace('Bearer ', '');
  
  try {
    // éªŒè¯ç­¾å
    const message = 'HashFi Admin Authentication';
    const address = verifyMessage({
      message,
      signature,
    });
    
    // æ£€æŸ¥æ˜¯å¦æ˜¯ç®¡ç†å‘˜åœ°å€
    const ADMIN_ADDRESS = '0xYourAdminAddress';
    return address.toLowerCase() === ADMIN_ADDRESS.toLowerCase();
  } catch {
    return false;
  }
}
```

## ğŸ› æ•…éšœæ’é™¤

### é—®é¢˜: æ— æ³•åŠ è½½è½®æ’­å›¾/å…¬å‘Š

**è§£å†³**: 
1. æ£€æŸ¥ `.env` æ–‡ä»¶ä¸­çš„ `VITE_API_URL` æ˜¯å¦æ­£ç¡®
2. æ£€æŸ¥ Worker æ˜¯å¦éƒ¨ç½²æˆåŠŸ
3. æ‰“å¼€æµè§ˆå™¨æ§åˆ¶å°æŸ¥çœ‹ç½‘ç»œè¯·æ±‚

### é—®é¢˜: æ— æ³•åˆ›å»º/æ›´æ–°/åˆ é™¤

**è§£å†³**:
1. ç¡®ä¿å·²ç»è¿›è¡Œç­¾åè®¤è¯
2. æ£€æŸ¥ localStorage ä¸­æ˜¯å¦æœ‰ `admin_signature`
3. æ£€æŸ¥æµè§ˆå™¨æ§åˆ¶å°çš„é”™è¯¯ä¿¡æ¯

### é—®é¢˜: KV namespace not found

**è§£å†³**:
1. ç¡®ä¿å·²ç»åˆ›å»º KV å‘½åç©ºé—´
2. æ£€æŸ¥ `wrangler.toml` ä¸­çš„ KV ID æ˜¯å¦æ­£ç¡®

## ğŸ“ ä¸‹ä¸€æ­¥

1. âœ… éƒ¨ç½² Cloudflare Worker
2. âœ… é…ç½®å‰ç«¯ç¯å¢ƒå˜é‡
3. âœ… æµ‹è¯•è½®æ’­å›¾å’Œå…¬å‘Šç®¡ç†
4. ğŸ”„ æ›´æ–° `BannerCarousel.vue` ä» API è·å–æ•°æ®
5. ğŸ”„ æ›´æ–° `AnnouncementBanner.vue` ä» API è·å–æ•°æ®
6. ğŸ”„ (å¯é€‰) å®ç°çœŸæ­£çš„ç­¾åéªŒè¯

## ğŸ‰ å®Œæˆ!

ç°åœ¨ä½ æœ‰ä¸€ä¸ªå®Œå…¨å…è´¹çš„ã€å¯è‡ªå®šä¹‰çš„è½®æ’­å›¾å’Œå…¬å‘Šç®¡ç†ç³»ç»Ÿäº†!
