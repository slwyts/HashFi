# 测试网时间配置说明 ⏰

## 🎯 功能说明

为了方便在测试网上快速测试收益释放功能，合约会**自动检测 chainID** 并调整时间单位：

### 时间配置对照表

| 网络 | Chain ID | 时间单位 | 动态奖励释放周期 | 说明 |
|------|----------|----------|------------------|------|
| **Sepolia Testnet** | 11155111 | **3 分钟** | **500 分钟** (8.3小时) | 测试网快速模式 |
| **主网 (Ethereum)** | 1 | **1 天** | **100 天** | 生产环境 |
| **其他网络** | 其他 | **1 天** | **100 天** | 默认配置 |

## 📊 具体影响

### 1. 静态收益释放

#### 主网（1天）
```
投入: 233 USDT (青铜)
日释放率: 0.7%
每天释放: 233 × 1.5 × 0.7% × 90% = 2.2 USDT
等待时间: 1天后可提现
```

#### Sepolia 测试网（3分钟）
```
投入: 233 USDT (青铜)
日释放率: 0.7%
每3分钟释放: 233 × 1.5 × 0.7% × 90% = 2.2 USDT
等待时间: 3分钟后可提现 ⚡
```

### 2. 动态奖励释放

#### 主网（100天）
```
获得推荐奖励: 10 HAF
释放周期: 100天
每天释放: 0.1 HAF
```

#### Sepolia 测试网（500分钟 ≈ 8.3小时）
```
获得推荐奖励: 10 HAF
释放周期: 500分钟
每3分钟释放: 0.06 HAF ⚡
完全释放: 约8.3小时
```

### 3. HAF 价格自动上涨

#### 主网（1天）
```
初始价格: 1 HAF = 1 USDT
涨幅: 每天 0.1%
第2天: 1.001 USDT
第30天: 1.030 USDT
```

#### Sepolia 测试网（3分钟）
```
初始价格: 1 HAF = 1 USDT
涨幅: 每3分钟 0.1%
6分钟后: 1.001 USDT ⚡
1.5小时后: 1.030 USDT
```

## 🧪 测试流程示例

### 在 Sepolia 测试网快速测试

```
时间轴                      操作                           结果
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

00:00                    投入 233 USDT (青铜)            ✅ 质押成功
                                                          订单创建

00:03                    查看收益页面                    ✅ 显示: 0.88 HAF
(3分钟后)                                                 可提现

00:03                    点击提现                        ✅ 提现成功
                                                          到账: 0.836 HAF
                                                          (扣除5%手续费)

00:06                    查看收益页面                    ✅ 显示: 0.88 HAF
(再过3分钟)                                               可提现

00:06                    点击提现                        ✅ 再次提现成功
                                                          
...每3分钟可提现一次
```

## 💻 代码实现

### 1. 时间单位配置（构造函数）

```solidity
constructor(address _usdtAddress, address _initialOwner) {
    // ... 其他初始化代码
    
    // 根据 chainID 设置时间单位
    if (block.chainid == 11155111) {
        TIME_UNIT = 3 minutes;              // Sepolia: 3分钟
        DYNAMIC_RELEASE_PERIOD = 500 minutes; // Sepolia: 500分钟
    } else {
        TIME_UNIT = 1 days;                 // 主网: 1天
        DYNAMIC_RELEASE_PERIOD = 100 days;  // 主网: 100天
    }
}
```

### 2. 使用时间单位

```solidity
// 静态收益结算
function _settleStaticRewardForOrder(uint256 _orderId) internal {
    // 计算经过了多少个时间单位
    uint256 daysPassed = (block.timestamp - order.lastSettleTime) / TIME_UNIT;
    
    // 更新结算时间
    order.lastSettleTime = order.lastSettleTime + (daysPassed * TIME_UNIT);
}

// 动态收益计算
function _calculatePendingDynamic(address _user) internal view returns (uint256) {
    uint256 totalReleased = user.dynamicRewardTotal
        .mul(block.timestamp - user.dynamicRewardStartTime)
        .div(DYNAMIC_RELEASE_PERIOD); // 使用配置的释放周期
}
```

## 🔍 如何验证网络配置

### 方法1: 查看合约状态变量

```javascript
// 在前端调用
const timeUnit = await contract.TIME_UNIT();
const releasePerriod = await contract.DYNAMIC_RELEASE_PERIOD();

console.log('时间单位:', timeUnit.toString(), '秒');
console.log('释放周期:', releasePerriod.toString(), '秒');

// Sepolia 会显示:
// 时间单位: 180 秒 (3分钟)
// 释放周期: 30000 秒 (500分钟)
```

### 方法2: 检查 chainID

```javascript
const chainId = await provider.getNetwork().then(n => n.chainId);
console.log('当前网络 Chain ID:', chainId);

// Sepolia: 11155111
// Ethereum 主网: 1
```

## ⚠️ 注意事项

### 1. 合约部署后不可修改

- ❗ 时间单位在**合约部署时确定**
- ❗ 无法在运行时修改
- ❗ 不同网络需要部署不同的合约实例

### 2. 测试网专用

- ✅ **仅在 Sepolia (chainID: 11155111) 使用3分钟**
- ✅ 其他网络自动使用1天
- ✅ 确保在正确的网络测试

### 3. 数据一致性

- 同一订单在不同网络的释放速度不同
- 测试网数据**不能**迁移到主网
- 主网和测试网使用**独立的合约实例**

## 🚀 部署指南

### Sepolia 测试网部署

```bash
# 1. 编译合约
npx hardhat compile

# 2. 部署到 Sepolia
npx hardhat run scripts/deploy.js --network sepolia

# 3. 验证合约
npx hardhat verify --network sepolia <合约地址> <USDT地址> <Owner地址>

# 4. 验证时间配置
# 调用 TIME_UNIT() 应该返回 180 (3分钟 = 180秒)
```

### 主网部署

```bash
# 1. 部署到主网
npx hardhat run scripts/deploy.js --network mainnet

# 2. 验证时间配置
# 调用 TIME_UNIT() 应该返回 86400 (1天 = 86400秒)
```

## 📋 测试检查清单

在 Sepolia 测试网测试时，请确认：

- [ ] 合约 TIME_UNIT 为 180 秒（3分钟）
- [ ] 质押后3分钟可查看收益
- [ ] 每3分钟释放一次收益
- [ ] 提现功能正常
- [ ] 动态奖励在500分钟内释放完成
- [ ] HAF价格每3分钟上涨0.1%

## 🎉 优势

1. **快速测试** - 无需等待24小时，3分钟即可看到结果
2. **自动配置** - 根据网络自动调整，无需手动修改
3. **安全可靠** - 主网保持1天周期，不影响生产环境
4. **易于调试** - 可以在短时间内测试多个周期

---

**总结**: 在 Sepolia 测试网，所有"天"都变成了"3分钟"，让你可以快速验证功能！🚀
